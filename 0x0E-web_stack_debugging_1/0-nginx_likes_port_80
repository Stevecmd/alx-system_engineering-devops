#!/usr/bin/env bash
# Fixes for Nginx to ensure it's running and listening on port 80

# Update the Nginx configuration to listen on port 80
sudo sed -i "s/listen 8080 default_server;/listen 80 default_server;/" /etc/nginx/sites-enabled/default
sudo sed -i "s/listen \[::\]:8080 default_server;/listen \[::\]:80 default_server;/" /etc/nginx/sites-enabled/default

# Restart Nginx to apply the changes
sudo service nginx restart

# Check if Nginx is running and listening on port 80
if curl -s -o /dev/null -w "%{http_code}" http://localhost:80 | grep -q "200"; then
	echo "Nginx is running and listening on port 80"
	exit 0
else
	echo "Nginx is not running or not listening on port 80"
	exit 1
fi
